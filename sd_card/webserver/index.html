<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Alarm Clock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Add new audio files here!!! -->
    <script type="text/javascript">
        // Audio data
        var audioArray=['alarm.mp3', 'alien.mp3', 'bedside.mp3', 'beep.mp3', 'bell.mp3', 'chimes.mp3', 'chiptune.mp3', 'digital.mp3', 'digital_2.mp3', 'dream.mp3', 'electronic.mp3', 'epic_music.mp3', 'generic.mp3', 'marimba.mp3', 'mario.mp3', 'mechanical.mp3', 'oversimplified.mp3', 'pitches.mp3', 'ringing.mp3', 'stardust.mp3'];
    </script>
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    <style>
        html {
    font-family: monospace; 
    text-align: center;
}

body {
    max-width: 400px; 
    margin:0px auto;
    background-color: black;
    color: white;
}

 /* The Overlay (background) */
 .overlay {
    /* Height & width depends on how you want to reveal the overlay (see JS below) */   
    height: 100%;
    width: 100%;
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    background-color: rgb(0,0,0); /* Black fallback color */
    background-color: rgba(0,0,0, 0.95); /* Black w/opacity */
    overflow-x: hidden; /* Disable horizontal scroll */
    font-family: monospace;
    display: none;
  }
  
  /* Position the content inside the overlay */
  .overlay-content {
    position: relative;
    top: 25%; /* 25% from the top */
    width: 100%; /* 100% width */
    text-align: center; /* Centered text/links */
  }
  
  .overlay span, .overlay button {
    padding: 8px;
    color: red;
    font-size: 20Svw;
    margin: 4vw;
    width: 90%;
    font-family: monospace;
  }

  .overlay button {
    border: 2px solid red;
    border-radius: 12px;
    background-color: transparent;
  }

  .overlay button:disabled {
    border: 2px solid grey;
    color: grey;
  }
    </style>
    <!-- <link rel="stylesheet" type="text/css" href="container.css"> -->
    <style>
        
@font-face {
    font-family: sevenSegmentFont;
    src: url(fonts/digital-7.regular.ttf);
}

.container {  
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 0.3fr 0.5fr 0.5fr 0.5fr 0.3fr;
    gap: 2% 4%;
    grid-auto-flow: row;
    grid-template-areas:
      ". ."
      "alarmGridArea alarmGridArea"
      "snoozeGridArea volumeGridArea"
      "audioGridArea timezoneGridArea"
      ". .";
    width: 90%;
    height: 100%;
    margin-left: 5%;
    margin-right: 5%;
    font-family: sevenSegmentFont;
    text-align: center;
    color: red;
}

.container > div {
    border: 2px solid red;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    justify-content: end;
    align-items: center;
    font-size: 10vw;
}

.container > div > img {
    width: auto;
    height: 60%;
}

.caption {
    display: block;
}

.alarmGridArea {
    grid-area: alarmGridArea;
    justify-content: center !important;
    align-items: center !important;
    font-size: 25vw !important;
}

.snoozeGridArea {
    grid-area: snoozeGridArea;
}

.volumeGridArea {
    grid-area: volumeGridArea;
}

.audioGridArea {
    grid-area: audioGridArea;
}

.timezoneGridArea {
    grid-area: timezoneGridArea;
}

ul,ol{
    padding-left:0; 
    list-style-type:none;
    margin:0;
    text-align: center;
}
  
html, body {
    height: 100%;
    margin: 0;
}
    </style>
    <!-- <link rel="stylesheet" type="text/css" href="mobile-select/style/mobileSelect.css"> -->
    <style>
        .mobileSelect {
    position: relative;
    z-index: -1;
    opacity: 0;
    transition: all 0.4s;
  }
  .mobileSelect .grayLayer {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: #111;
    background: rgba(0, 0, 0, 0.7);
    z-index: 888;
    display: block;
  }
  .mobileSelect .content {
    width: 100%;
    display: block;
    position: fixed;
    z-index: 889;
    color: white;
    transition: all 0.4s;
    bottom: -350px;
    background: black;
  }
  .mobileSelect .content .fixWidth {
    width: 90%;
    margin: 0 auto;
    position: relative;
  }
  .mobileSelect .content .fixWidth:after {
    content: ".";
    display: block;
    height: 0;
    clear: both;
    visibility: hidden;
  }
  .mobileSelect .content .btnBar {
    border-bottom: 1px solid #232323;
    font-size: 15px;
    height: 45px;
    position: relative;
    text-align: center;
    line-height: 45px;
  }
  .mobileSelect .content .btnBar .cancel,
  .mobileSelect .content .btnBar .ensure {
    height: 45px;
    width: 55px;
    cursor: pointer;
    position: absolute;
    top: 0;
  }
  .mobileSelect .content .btnBar .cancel {
    left: 0;
    color: #999;
  }
  .mobileSelect .content .btnBar .ensure {
    right: 0;
    color: #c9c9c9;
  }
  .mobileSelect .content .btnBar .title {
    font-size: 15px;
  }
  .mobileSelect .content .panel:after {
    content: ".";
    display: block;
    height: 0;
    clear: both;
    visibility: hidden;
  }
  .mobileSelect .content .panel .wheels {
    width: 100%;
    height: 200px;
    overflow: hidden;
  }
  .mobileSelect .content .panel .wheel {
    position: relative;
    z-index: 0;
    float: left;
    width: 50%;
    height: 200px;
    overflow: hidden;
    transition: width 0.3s ease;
  }
  .mobileSelect .content .panel .wheel .selectContainer {
    display: block;
    text-align: center;
    transition: transform 0.18s ease-out;
  }
  .mobileSelect .content .panel .wheel .selectContainer li {
    font-size: 15px;
    display: block;
    height: 40px;
    line-height: 40px;
    cursor: pointer;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  .mobileSelect .content .panel .selectLine {
    height: 40px;
    width: 100%;
    position: absolute;
    top: 80px;
    pointer-events: none;
    -moz-box-sizing: border-box;
         box-sizing: border-box;
    border-top: 1px solid #232323;
    border-bottom: 1px solid #232323;
  }
  .mobileSelect .content .panel .shadowMask {
    position: absolute;
    top: 0;
    width: 100%;
    height: 200px;
    background: linear-gradient(to bottom, #000000, rgba(0, 0, 0, 0), #000000);
    opacity: 0.9;
    pointer-events: none;
  }
  .mobileSelect-show {
    opacity: 1;
    z-index: 10000;
  }
  .mobileSelect-show .content {
    bottom: 0;
  }
  
    </style>
    <!-- <script src="mobile-select/mobileSelect.js" ></script> -->
    <script type="text/javascript">
        window.MobileSelect = (function() {

function getClass(dom,string) {
    return dom.getElementsByClassName(string);
}

//构造器
function MobileSelect(config) {
    this.mobileSelect;
    this.wheelsData = config.wheels;
    this.jsonType =  false;
    this.jsonData = [];
    this.checkDataType();
    this.renderWheels(this.wheelsData);
    this.displayJson = []; 
    this.cascade = false;
    this.startY;
    this.moveEndY;
    this.moveY;
    this.oldMoveY;
    this.offset = 0;
    this.offsetSum = 0;
    this.oversizeBorder;
    this.curDistance = [];
    this.clickStatus = false;

    this.init(config);
}

MobileSelect.prototype = {
    constructor: MobileSelect,
    init: function(config){
        var _this = this; 

        _this.trigger = document.querySelector(config.trigger);
        _this.wheel = getClass(_this.mobileSelect,'wheel');   //wheel 数组
        _this.slider = getClass(_this.mobileSelect,'selectContainer'); // slider 数组
        _this.wheels = _this.mobileSelect.querySelector('.wheels');   //wheels
        _this.liHeight = _this.mobileSelect.querySelector('li').offsetHeight;
        _this.ensureBtn = _this.mobileSelect.querySelector('.ensure');
        _this.closeBtn = _this.mobileSelect.querySelector('.cancel');
        _this.grayLayer = _this.mobileSelect.querySelector('.grayLayer');
        _this.popUp = _this.mobileSelect.querySelector('.content');
        _this.callback = config.callback ? config.callback : function(){};
        _this.limit = config.limit ? config.limit : function(){};
        _this.initPosition = config.position ? config.position : [];
        _this.titleText = config.title ? config.title : '';

        _this.trigger.readOnly=true;
        _this.trigger.style.cursor='pointer';
        _this.setTitle(_this.titleText);
        _this.checkCascade();

        if (_this.cascade) {
            _this.initCascade();
        }

        //定位 初始位置
        if(_this.initPosition.length == 0){
            for(var i=0; i<_this.slider.length; i++){
                _this.initPosition.push(0);
            }
        }

        _this.setCurDistance(_this.initPosition);
        _this.addListenerAll();

        //按钮监听
        _this.closeBtn.addEventListener('click',function(){
            _this.mobileSelect.classList.remove('mobileSelect-show');
        });

        _this.ensureBtn.addEventListener('click',function(){
            _this.mobileSelect.classList.remove('mobileSelect-show');
            var tempValue ='';
            for(var i=0; i<_this.wheel.length; i++){
                i==_this.wheel.length-1 ? tempValue += _this.getValue(i) : tempValue += _this.getValue(i)+' ';
            }
            _this.trigger.value = tempValue;
            _this.callback(_this.getIndexArr(),_this.getJson());
        });

        _this.trigger.addEventListener('click',function(){
            _this.mobileSelect.classList.add('mobileSelect-show');
        });
        _this.grayLayer.addEventListener('click',function(){
            _this.mobileSelect.classList.remove('mobileSelect-show');
        });
        _this.popUp.addEventListener('click',function(){
            event.stopPropagation(); 
        });

        _this.fixRowStyle(); //修正列数
    },

    setTitle: function(string){
        var _this = this;
        _this.titleText = string;
        _this.mobileSelect.querySelector('.title').innerHTML = _this.titleText;
    },

    renderWheels: function(wheelsData){
        var _this = this;
        _this.mobileSelect = document.createElement("div");
        _this.mobileSelect.className = "mobileSelect";
        _this.mobileSelect.innerHTML = 
            '<div class="grayLayer"></div>'+
            '<div class="content">'+
                '<div class="btnBar">'+
                    '<div class="fixWidth">'+
                        '<div class="cancel">Cancel</div>'+
                        '<div class="title"></div>'+
                        '<div class="ensure">Save</div>'+
                    '</div>'+
                '</div>'+
                '<div class="panel">'+
                    '<div class="fixWidth">'+
                        '<div class="wheels">'+
                        '</div>'+
                        '<div class="selectLine"></div>'+
                        '<div class="shadowMask"></div>'+
                    '</div>'+
                '</div>'+
            '</div>';
        document.body.appendChild(_this.mobileSelect);

        //根据数据长度来渲染

        var tempHTML='';
        for(var i=0; i<wheelsData.length; i++){ //列
            tempHTML += '<div class="wheel"><ul class="selectContainer">';
            if(_this.jsonType){
                for(var j=0; j<wheelsData[i].data.length; j++){ //行
                    tempHTML += '<li data-id="'+wheelsData[i].data[j].id+'">'+wheelsData[i].data[j].value+'</li>';
                }
            }else{
                for(var j=0; j<wheelsData[i].data.length; j++){ //行
                    tempHTML += '<li>'+wheelsData[i].data[j]+'</li>';
                }
            }
            tempHTML += '</ul></div>';
        }
        _this.mobileSelect.querySelector('.wheels').innerHTML = tempHTML;
    },

    addListenerAll: function(){
        var _this = this;
        for(var i=0; i<_this.slider.length; i++){
            //手势监听
            (function (i) {
                _this.addListenerWheel(_this.wheel[i], i);
                _this.addListenerLi(i);
            })(i);
        }
    },

    addListenerWheel: function(theWheel, index){
        var _this = this;
        theWheel.addEventListener('touchstart', function () {
            _this.touch(event, this.firstChild, index);
        },false);
        theWheel.addEventListener('touchend', function () {
            _this.touch(event, this.firstChild, index);
        },false);
        theWheel.addEventListener('touchmove', function () {
            _this.touch(event, this.firstChild, index);
        },false);

        //PC拖拽监听
        theWheel.addEventListener('mousedown', function () {
            _this.dragClick(event, this.firstChild, index);
        },false);
        theWheel.addEventListener('mousemove', function () {
            _this.dragClick(event, this.firstChild, index);
        },false);
        theWheel.addEventListener('mouseup', function () {
            _this.dragClick(event, this.firstChild, index);
        },true); 
    },

    addListenerLi:function(sliderIndex){
        var _this = this;
        var curWheelLi = _this.slider[sliderIndex].getElementsByTagName('li');
        for(var j=0; j<curWheelLi.length;j++){
            (function (j) {
                curWheelLi[j].addEventListener('click',function(){
                    _this.singleClick(this, j, sliderIndex);
                },false);
            })(j);
        }
    },

    checkDataType: function(){ 
        var _this = this;
        if(typeof(_this.wheelsData[0].data[0])=='object'){
            _this.jsonType = true;
            _this.jsonData = _this.wheelsData[0].data;
        }
    },

    checkCascade: function(){
        var _this = this;
        if(_this.jsonType){ 
            var node = _this.wheelsData[0].data;
            for(var i=0; i<node.length; i++){
                if('childs' in node[i] && node[i].childs.length > 0){
                    _this.cascade = true;
                    break;
                }
            }
        }else{
            _this.cascade = false;
        }
    },

    initCascade: function(){
        var _this = this;
        _this.displayJson.push(_this.generateArrData(_this.jsonData));
        _this.checkArrDeep(_this.jsonData[0]);
        //console.log('将要显示的json:'); 
        //console.log(_this.displayJson);
        _this.updateWheels();
    },

    generateArrData: function (targetArr) {
        var tempArr = [];
        for(var i=0; i<targetArr.length; i++){
            tempArr.push({
                "id": targetArr[i].id,
                "value": targetArr[i].value
            });	
        }
        return tempArr;
    },

    checkArrDeep: function (parent) { //检测子节点深度  修改 displayJson
        var _this = this;
        if ('childs' in parent && parent.childs.length > 0) {
            _this.displayJson.push(_this.generateArrData(parent.childs)) ; //生成子节点数组
            _this.checkArrDeep(parent.childs[0]);//检测下一个子节点
        }
    },

    checkRange: function(index, posIndexArr){
        var _this = this;
        var deleteNum = _this.displayJson.length-1-index;
        for(var i=0; i<deleteNum; i++){
            _this.displayJson.pop(); //修改 displayJson
        }
        var resultNode;
        for (var i = 0; i <= index; i++){
            if (i == 0)
                resultNode = _this.jsonData[posIndexArr[0]];
            else {
                resultNode = resultNode.childs[posIndexArr[i]];
            }
        }
        _this.checkArrDeep(resultNode);
        //console.log(_this.displayJson);
        _this.updateWheels();
        _this.fixRowStyle();
        _this.setCurDistance(_this.resetPostion(index, posIndexArr));
    },

    resetPostion: function(index, posIndexArr){
        var _this = this;
        var tempPosArr = posIndexArr;
        var tempCount;
        if(_this.slider.length > posIndexArr.length){ 
            tempCount = _this.slider.length - posIndexArr.length;
            for(var i=0; i<tempCount; i++){  
                tempPosArr.push(0);
            }
        }else if(_this.slider.length < posIndexArr.length){
            tempCount = posIndexArr.length - _this.slider.length;
            for(var i=0; i<tempCount; i++){
                tempPosArr.pop();
            }	
        }
        for(var i=index+1; i< tempPosArr.length; i++){
            tempPosArr[i] = 0;
        } 
        return tempPosArr;
    },

    updateWheels: function(){
        var _this = this;
        //删除多余的wheel
        if(_this.wheel.length > _this.displayJson.length){
            var count = _this.wheel.length - _this.displayJson.length;
            for(var i=0; i<count; i++){
                _this.wheels.removeChild(_this.wheel[_this.wheel.length-1]);
            }
        }

        for(var i=0; i<_this.displayJson.length; i++){ //列
            (function (i) {
                var tempHTML='';
                if(_this.wheel[i]){
                    //console.log('插入Li');
                    for(var j=0; j<_this.displayJson[i].length; j++){ //行
                        tempHTML += '<li data-id="'+_this.displayJson[i][j].id+'">'+_this.displayJson[i][j].value+'</li>';
                    }
                    _this.slider[i].innerHTML = tempHTML;

                }else{
                    var tempWheel = document.createElement("div");
                    tempWheel.className = "wheel";
                    tempHTML = '<ul class="selectContainer">';
                    for(var j=0; j<_this.displayJson[i].length; j++){ //行
                        tempHTML += '<li data-id="'+_this.displayJson[i][j].id+'">'+_this.displayJson[i][j].value+'</li>';
                    }
                    tempHTML += '</ul>';
                    tempWheel.innerHTML = tempHTML;

                    _this.addListenerWheel(tempWheel, i);
                    _this.wheels.appendChild(tempWheel); 
                }
                _this.addListenerLi(i);
            })(i);
        }
    },

    updateWheel: function(sliderIndex, data){
        var _this = this;
        var tempHTML='';
        for(var j=0; j<data.length; j++){
            tempHTML += '<li>'+data[j]+'</li>'
        }
        _this.slider[sliderIndex].innerHTML = tempHTML;
        _this.addListenerLi(sliderIndex);
    },

    fixRowStyle: function(){
        var _this = this;
        var width = (100/_this.wheel.length).toFixed(2);
        for(var i=0; i<_this.wheel.length; i++){
            _this.wheel[i].style.width = width+'%';
        }
    },

    getIndex: function(distance){
        return Math.round((2*this.liHeight-distance)/this.liHeight);
    },

    getIndexArr: function(){
        var _this = this;
        var temp = [];
        for(var i=0; i<_this.curDistance.length; i++){
            temp.push(_this.getIndex(_this.curDistance[i]));
        }
        return temp;
    },

    getJson: function(){
        var _this = this;
        var temp = [];
        var positionArr = _this.getIndexArr();
        if(_this.cascade){
            for(var i=0; i<_this.wheel.length; i++){
                temp.push(_this.displayJson[i][positionArr[i]]);
            }
        }
        else if(_this.jsonType){
            for(var i=0; i<_this.curDistance.length; i++){
                temp.push(_this.wheelsData[i].data[_this.getIndex(_this.curDistance[i])]);
            }
        }else{
            for(var i=0; i<_this.curDistance.length; i++){
                temp.push(_this.getValue(i));
            }
        }
        return temp;
    },

    calcDistance: function(index){
        return 2*this.liHeight-index*this.liHeight;
    },

    setCurDistance: function(indexArr){
        var _this = this;
        var temp = [];
        for(var i=0; i<_this.slider.length; i++){
            temp.push(_this.calcDistance(indexArr[i]));
            _this.movePosition(_this.slider[i],temp[i]);
        }
        _this.curDistance = temp;
    },

    fixPosition: function(distance){
        return -(this.getIndex(distance)-2)*this.liHeight;
    },

    movePosition: function(theSlider, distance){
        theSlider.style.webkitTransform = 'translate3d(0,' + distance + 'px, 0)';
        theSlider.style.transform = 'translate3d(0,' + distance + 'px, 0)';
    },

    locatePosition: function(index, posIndex){
        this.curDistance[index] = this.calcDistance(posIndex);
        this.movePosition(this.slider[index],this.curDistance[index]);
    },

    updateCurDistance: function(theSlider, index){
        this.curDistance[index] = parseInt(theSlider.style.transform.split(',')[1]);
    },

    getDistance:function(theSlider){
        return parseInt(theSlider.style.transform.split(',')[1]);
    },

    getValue: function(sliderIndex){
        var _this = this;
        var index = _this.getIndex(_this.curDistance[sliderIndex]);
        return _this.slider[sliderIndex].getElementsByTagName('li')[index].innerHTML;
    },

    touch: function(event, theSlider, index){
        var _this = this;
        event = event || window.event;
        switch(event.type){
            case "touchstart":
                _this.startY = event.touches[0].clientY;
                _this.oldMoveY = _this.startY;
                break;

            case "touchend":

                _this.moveEndY = event.changedTouches[0].clientY;
                _this.offsetSum = _this.moveEndY - _this.startY;

                //修正位置
                _this.updateCurDistance(theSlider, index);
                _this.curDistance[index] = _this.fixPosition(_this.curDistance[index]);
                _this.movePosition(theSlider, _this.curDistance[index]);
                _this.oversizeBorder = -(theSlider.getElementsByTagName('li').length-3)*_this.liHeight; 


                //反弹
                if(_this.curDistance[index] + _this.offsetSum > 2*_this.liHeight){
                    _this.curDistance[index] = 2*_this.liHeight;
                    setTimeout(function(){
                        _this.movePosition(theSlider, _this.curDistance[index]);
                    }, 100);

                }else if(_this.curDistance[index] + _this.offsetSum < _this.oversizeBorder){
                    _this.curDistance[index] = _this.oversizeBorder;
                    setTimeout(function(){
                        _this.movePosition(theSlider, _this.curDistance[index]);
                    }, 100);
                }


                _this.limit(_this.getIndexArr(),_this.getJson());

                if(_this.cascade){
                    var tempPosArr = _this.getIndexArr();
                    tempPosArr[index] = _this.getIndex(_this.curDistance[index]);
                    _this.checkRange(index, tempPosArr);
                }

                break;

            case "touchmove":
                event.preventDefault();
                _this.moveY = event.touches[0].clientY;
                _this.offset = _this.moveY - _this.oldMoveY;

                _this.updateCurDistance(theSlider, index);
                _this.curDistance[index] = _this.curDistance[index] + _this.offset;
                _this.movePosition(theSlider, _this.curDistance[index]);
                _this.oldMoveY = _this.moveY;
                break;
        }
    },

    dragClick: function(event, theSlider, index){
        var _this = this;
        event = event || window.event;
        switch(event.type){
            case "mousedown":
                _this.startY = event.clientY;
                _this.oldMoveY = _this.startY;
                _this.clickStatus = true;
                break;

            case "mouseup":

                _this.moveEndY = event.clientY;
                _this.offsetSum = _this.moveEndY - _this.startY;

                //修正位置
                _this.updateCurDistance(theSlider, index);
                _this.curDistance[index] = _this.fixPosition(_this.curDistance[index]);
                _this.movePosition(theSlider, _this.curDistance[index]);
                _this.oversizeBorder = -(theSlider.getElementsByTagName('li').length-3)*_this.liHeight; 


                //反弹
                if(_this.curDistance[index] + _this.offsetSum > 2*_this.liHeight){
                    _this.curDistance[index] = 2*_this.liHeight;
                    setTimeout(function(){
                        _this.movePosition(theSlider, _this.curDistance[index]);
                    }, 100);

                }else if(_this.curDistance[index] + _this.offsetSum < _this.oversizeBorder){
                    _this.curDistance[index] = _this.oversizeBorder;
                    setTimeout(function(){
                        _this.movePosition(theSlider, _this.curDistance[index]);
                    }, 100);
                }

                _this.clickStatus = false;
                _this.limit(_this.getIndexArr(),_this.getJson());
                if(_this.cascade){
                    var tempPosArr = _this.getIndexArr();
                    tempPosArr[index] = _this.getIndex(_this.curDistance[index]);
                    _this.checkRange(index, tempPosArr);
                }
                break;

            case "mousemove":
                event.preventDefault();
                if(_this.clickStatus){
                    _this.moveY = event.clientY;
                    _this.offset = _this.moveY - _this.oldMoveY;

                    _this.updateCurDistance(theSlider, index);
                    _this.curDistance[index] = _this.curDistance[index] + _this.offset;
                    _this.movePosition(theSlider, _this.curDistance[index]);
                    _this.oldMoveY = _this.moveY;
                }
                break;
        }
    },

    singleClick: function(theLi, index, sliderIndex){
        var _this = this;
        if(_this.cascade){
            var tempPosArr = _this.getIndexArr();
            tempPosArr[sliderIndex] = index;
            _this.checkRange(sliderIndex, tempPosArr);

        }else{
            _this.curDistance[sliderIndex] = (2-index)*_this.liHeight;
            _this.movePosition(theLi.parentNode, _this.curDistance[sliderIndex]);
        }
    }

};

return MobileSelect;
})();
    </script>
</head>
<body>
    
    <div class="container">
        <div class="alarmGridArea" id="alarmTrigger">
            <span id="alarmText">NULL</span>
        </div>
        <div class="snoozeGridArea" id="snoozeTrigger">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABDElEQVR42u2bQQ7DIAwEofL/v5xeewhSCcFe7NljVSmZwUQYktYIIZXTTwe4WrsmgXuqEZwRcPdfqyAh3ag/lTM7XYAHHnjggQce+NzwllnIP6tC876BF7q3/nTJW7YXCJkCbzcgI8jV63xa8ZhiWXq2sFSA2tz3XshIVcAIfqeUrgj/W0Wj31MJiIKXEBAJHy4gGj5UgAJ8mAAV+BABSvDuAtTgXQUowrsJUIV3EaAMv12AOvxWASfAbxNwCvwWASfBb90PGEGqva3hvi2utlfInqDjw0Zyr5AKWDU9GtlTjqltpVwznMXbE7CVE9rjw9sYwAMPPPDAAw98mW6w3Ocoqx8hlegFCCEkS7706bIDcePUTgAAAABJRU5ErkJggg==" />
            <span class="caption" id="snoozeText">NULL</span>
        </div>
        <div class="volumeGridArea" id="volumeTrigger">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABuElEQVR42u2a0RKEIAhFkfH/f9l9aqZp0kWFLhS82rbdAyioRGlpaWkOrBE1xP/yl8W7AIAUDweAFg8F4EE8DMBZfCEqnwLgSTwRUY0k3gIeR/W81hxSPIg/xqVgruJ3gHLEnC9E5fyunWjgCOIbUbsTqQGBI3m+B+F4/woEjiD+6ulRNMxC4Aiel+b9CgSOIH4l76UQisU6Oyt+tAyujM0sq2zpIevmqRfyM6lQUYJmgB5CGlHrfU9vbPQbFxsiu3nfEyd1XAgAUghu6gAEhNHzo2dDAZCEPLwQehKCRkscEoAmrPAA7qpPWCnsYS7IFEgACSABJIAvANA6FwgfAXf9wd0S2Vs2X58C/yKFI4vSKIb4LR5dhcJRxUuESqDwG8TvpETdnUSsmpRZ8avfzU/lqHXYr26OVk1PSravNdtfjYORgp6oVnJYmhLwkyGLq3C7KfHIKmAB4XosrnHVxnQZ1IRwFa4l3rwO0I6EnvCdOiDkLbGdCRdSCWpHgmQ+cBUB/zwmjQDN+4GQXkAzEhTvHOIbG83+PgSAXgQgAMDaYQ9X5eH7AR4gwDdEvESCqx2ftLS0x+wHouzSbM1GwCEAAAAASUVORK5CYII=" />
            <span class="caption" id="volumeText">NULL</span>
        </div>
        <div class="audioGridArea" id="audioTrigger">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABAUlEQVR42u2aSw7DIAwFceT7XzldVUKoac3H1MDMmlR6gw1W0pQAAAAAAOBEZLdAd0r3h5CPOXWHgD3ojgHfO275LV054BIV0BJYJp5Nf2kBCXT46omhc67T5wAEIAABCEAAAhCAAAQgAAEIQAACDmSrt8ItL1109dBP66wydLXw34Lla63SdJXwlh2t+R7QJWB0H44q53z98Arw7EPLrrY8N+zLkHcfhr4GZ/Rh2EGotw9nXoGtz13efTii92sl1Gxc6FG4lPBLRLnGsgHhB6HyNLdWg7X6xPNKG30leswg4hXCI7xThfnNAdHDmwW0XkeywL/QJEIfAgAAAAAAzOYFJCtaXfoLy58AAAAASUVORK5CYII=" />
            <span class="caption" id="audioText"><marquee scrollamount="4">NULL</marquee></span>
        </div>
        <div class="timezoneGridArea" id="timezoneTrigger">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAB4klEQVR42u1b267EIAhU0v//5Z6nkzSNtcAM6lp43S03BwRKS0lKSvoy1ZHCzlJOpVJ1CwdoDZ7pkLrKKc9CR402/Krw/3+ejGj9ruGLkEQZX0upDCWf+BDDi2+49nQ9/7PIDEXAXRHWiXsQgaChsoxHThVFC4IEQYwfdepaNHiQIIjx0bWA52q0ypNI473wRPlbnCAjjB8ZElYnSPk4yQoxPFN+9TLQhIL1+kOe9+p6WOLrKmSFvNDrEww3iD3xab0dgQDLSWsOyeWAEW0sgy/FARbFWR0a05lvdlTk9Ec6g6FHi8cRPX2pAS23VX6PRxZC6YBJiWyVukEi43/FJilDIB3wUgfsnANa4fB5BBzRBcxqfDIHpAOUDtgpGZp6gZ0KII1tGQJ5Db7Ezux+PjL+m5Ugcv9uMxK7G7PzUPRgw4o1Fr+OsnpjccJLW52hvdkauhbjha/2xQjlzRBjGyMyFzy9tYIQgBqOwNP7rFVfYScvNkqi5WcliMTayk2PFjmCJpyIIgnlbwkb8cbUiOVmzyaaVZ4gSp2lnDND4i6fXggxrxvWrjC7LhEWPEehoSUHDLOYlrO34u4pndlb4tQ64Elh1ppclPE0BDDa2J//ZCZyQPJTH01FDzmSkpKSmPQHaKkAcSIlhooAAAAASUVORK5CYII=" />
            <span class="caption" id="timezoneText">NULL</span>
        </div>
    </div>
    <div id="status" class="overlay">
        <div class="overlay-content">
            <span id="alarmStatus">Alarm</span>
            <button onclick="snooze()" id="snoozeButton">Snooze</button>
            <button onclick="stop()" id="stopButton">Stop</button>
        </div>
    </div>


    <script type="text/javascript">
        // Alarm data
        var hourArray=['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
        var minArray=['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59'];
        var amArray=['AM', 'PM'];
        var enableArray=['On', 'Off'];
        var repeatArray=['Once', 'Repeat'];

        // Snooze data
        var snoozeMinArray=['01 min', '02 min', '03 min', '04 min', '05 min', '06 min', '07 min', '08 min', '09 min', '10 min', '11 min', '12 min', '13 min', '14 min', '15 min'];
        var snoozesArray=['1x', '2x', '3x', '4x', '5x'];

        // Volume data
        var volumeArray=['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21'];
 
        // Timezone data
        var timezoneArray=['-12:00', '-11:00', '-10:00', '-9:30', '-9:00', '-8:00', '-7:00', '-6:00', '-5:00', '-4:00', '-3:30', '-3:00', '-2:00', '-1:00', '+0:00', '+1:00', '+2:00', '+3:00', '+3:30', '+4:00', '+4:30', '+5:00', '+5:30', '+5:45', '+6:00', '+6:30', '+7:00', '+8:00', '+8:45', '+9:00', '+9:30', '+10:00', '+10:30', '+11:00', '+12:00', '+13:00', '+13:45', '+14:00']

        // Alarm settings
        var alarmSelect = new MobileSelect({
            trigger: '#alarmTrigger',
            title: 'Set Alarm',
            wheels: [
                {data: hourArray},
                {data: minArray},
                {data: amArray},
                {data: enableArray},
                {data: repeatArray}
            ],
            limit:function(indexArr, data){ 
                // console.log(data);
            },
            callback:function(indexArr, data){
                console.log(indexArr, data);
                setAlarmData(data);
            }
        });

        // Snooze settings
        var snoozeSelect = new MobileSelect({
            trigger: '#snoozeTrigger',
            title: 'Set Snooze',
            wheels: [
                {data: snoozeMinArray},
                {data: snoozesArray},
                {data: enableArray}
            ],
            limit:function(indexArr, data){ 
                // console.log(data);
            },
            callback:function(indexArr, data){
                setSnoozeData(data);
            }
        });

        // Volume settings
        var volumeSelect = new MobileSelect({
            trigger: '#volumeTrigger',
            title: 'Set Volume',
            wheels: [
                {data: volumeArray}
            ],
            limit:function(indexArr, data){ 
                // console.log(data);
            },
            callback:function(indexArr, data){
                setVolumeData(data);
            }
        });

        // Audio settings
        var audioSelect = new MobileSelect({
            trigger: '#audioTrigger',
            title: 'Select Audio',
            wheels: [
                {data: audioArray}
            ],
            limit:function(indexArr, data){ 
                // console.log(data);
            },
            callback:function(indexArr, data){
                setAudioData(data);
            }
        });
        
        // Timezone settings
        var timezoneSelect = new MobileSelect({
            trigger: '#timezoneTrigger',
            title: 'Set Time Zone',
            wheels: [
                {data: timezoneArray}
            ],
            limit:function(indexArr, data){ 
                // console.log(data);
            },
            callback:function(indexArr, data){
                setTimezoneData(data);
            }
        });

    </script>

    <!-- <script src="script.js"></script> -->
    <script type="text/javascript">
        var gateway = `ws://${window.location.hostname}/ws`;
var websocket;
window.addEventListener('load', onload);

var max_volume = 21;
var min_volume = 0;
var alarmData;      

function onload(event) {
    initWebSocket();
}

function getData() {
    websocket.send("getData");
}

function sendData() {
    console.log("Sending data");
    websocket.send(JSON.stringify(alarmData));
}

function initWebSocket() {
    console.log('Trying to open a WebSocket connection…');
    websocket = new WebSocket(gateway);
    websocket.onopen = onOpen;
    websocket.onclose = onClose;
    websocket.onmessage = onMessage;
}

function onOpen(event) {
    console.log('Connection opened');
    getData();
}

function onClose(event) {
    console.log('Connection closed');
    setTimeout(initWebSocket, 2000);
}

function setAlarmData(data) {
    var hour = Number(data[0]);
    var isMorning = data[2] == "AM";
    if (!isMorning) {
        if (hour != 12) {
            hour += 12;
        }
    } else {
        if (hour == 12) {
            hour = 0;
        }
    }
    var minute = Number(data[1]);
    var enabled = data[3] == "On";
    var repeat = data[4] == "Repeat"

    alarmData[0]["alarm"]["enabled"] = enabled;
    alarmData[0]["alarm"]["hour"] = hour;
    alarmData[0]["alarm"]["minute"] = minute;
    alarmData[0]["alarm"]["currentHour"] = hour;
    alarmData[0]["alarm"]["currentMinute"] = minute;
    alarmData[0]["alarm"]["repeat"] = repeat;

    sendData();
    window.location.reload();
}

function setSnoozeData(data) {
    var duration = Number(data[0].split(" ")[0]);
    var limit = Number(data[1].split("x")[0]);
    var enabled = data[2] == "On";

    alarmData[0]["snooze"]["enabled"] = enabled;
    alarmData[0]["snooze"]["duration"] = duration;
    alarmData[0]["snooze"]["limit"] = limit;
    alarmData[0]["snooze"]["remaining"] = limit;

    sendData();
    window.location.reload();
}

function setVolumeData(data) {
    var volume = Number(data[0]);

    alarmData[0]["sound"]["volume"] = volume;

    sendData();
    window.location.reload();
}

function setAudioData(data) {
    var file = "/audio/" + data[0];

    alarmData[0]["sound"]["file"] = file;

    sendData();
    window.location.reload();
}

function setTimezoneData(data) {
    var splitData = data[0].split(":");
    var hour = Number(splitData[0]);
    var minute = Number(splitData[1]);
    minute = hour >= 0 ? minute : -minute;
    var timeOffset = hour * 60 * 60 + minute * 60;

    alarmData[0]["timeOffset"] = timeOffset;

    sendData();
    window.location.reload();
}

function snooze() {
    console.log("snooze");
    websocket.send("snooze");
    window.location.reload();
}

function stop() {
    console.log("stop");
    websocket.send("stop");
    window.location.reload();
}

function updateAlarmStatus(alarmActive, snoozeActive, snoozesRemaining, snoozeEnabled) {
    var alarmStatus = document.getElementById("alarmStatus");
    var snoozeButton = document.getElementById("snoozeButton");
    var stopButton = document.getElementById("stopButton");
    var statusDiv = document.getElementById("status");
    if (alarmActive) {
        alarmStatus.textContent = "ALARM";
        stopButton.disabled = false;
        snoozeButton.disabled = !(snoozeEnabled && snoozesRemaining > 0);
        statusDiv.style.display = "block";
    } else if (snoozeActive) {
        alarmStatus.textContent = "zzz x" + snoozesRemaining;
        stopButton.disabled = false;
        snoozeButton.disabled = true;
        statusDiv.style.display = "block";
    } else {
        alarmStatus.textContent = "";
        stopButton.disabled = true;
        snoozeButton.disabled = true;
        statusDiv.style.display = "none";
    }
}

function onMessage(event) {
    console.log(event.data);
    alarmData = JSON.parse(event.data);

    // Alarm settings
    var alarmHour = alarmData[0]["alarm"]["hour"];
    var ampm;
    if (alarmHour < 12) {
        ampm = "AM";
        if (alarmHour == 0) {
            alarmHour = 12;
        }
    } else {
        ampm = "PM";
        if (alarmHour != 12) {
            alarmHour -= 12;
        }
    }
    alarmHour = String(alarmHour);
    var alarmMinute = String(alarmData[0]["alarm"]["minute"]).padStart(2, '0');
    var alarmEnabled = alarmData[0]["alarm"]["enabled"] ? "On" : "Off";
    var alarmRepeat = alarmData[0]["alarm"]["repeat"] ? "Repeat" : "Once";
    alarmSelect.locatePosition(0, hourArray.indexOf(alarmHour));
    alarmSelect.locatePosition(1, minArray.indexOf(alarmMinute));
    alarmSelect.locatePosition(2, amArray.indexOf(ampm));
    alarmSelect.locatePosition(3, enableArray.indexOf(alarmEnabled));
    alarmSelect.locatePosition(4, repeatArray.indexOf(alarmRepeat));
    var alarmText = alarmData[0]["alarm"]["enabled"] ? alarmHour + ":" + alarmMinute + " " + ampm : "OFF";
    document.getElementById("alarmText").textContent = alarmText;

    // Snooze settings
    var snoozeDuration = String(alarmData[0]["snooze"]["duration"]).padStart(2, '0');
    var snoozeLimit = String(alarmData[0]["snooze"]["limit"]);
    var snoozeEnabled = alarmData[0]["snooze"]["enabled"] ? "On" : "Off";
    snoozeSelect.locatePosition(0, snoozeMinArray.indexOf(snoozeDuration + " min"));
    snoozeSelect.locatePosition(1, snoozesArray.indexOf(snoozeLimit + "x"));
    snoozeSelect.locatePosition(2, enableArray.indexOf(snoozeEnabled));
    var snoozeText = alarmData[0]["snooze"]["enabled"] ? snoozeDuration + " x " + snoozeLimit : "OFF";
    document.getElementById("snoozeText").textContent = snoozeText;

    // Volume settings
    var volume = String(alarmData[0]["sound"]["volume"]);
    volumeSelect.locatePosition(0, volumeArray.indexOf(volume));
    document.getElementById("volumeText").textContent = volume;

    // Audio settings
    var fileParts = alarmData[0]["sound"]["file"].split("/");
    var file = fileParts[fileParts.length - 1];
    audioSelect.locatePosition(0, audioArray.indexOf(file));
    var m = document.createElement("marquee"); 
    var m_text = document.createTextNode(file); 
    m.appendChild(m_text); 
    var audioContent = document.getElementById('audioText');
    while( audioContent.firstChild ) {
        audioContent.removeChild( audioContent.firstChild );
    }
    audioContent.appendChild(m);

    // Timezone settings
    var timezoneMinute = Math.floor(alarmData[0]["timeOffset"] / 60) % 60;
    var timezoneHour = Math.floor(((alarmData[0]["timeOffset"] / 60) - timezoneMinute) / 60);
    if (timezoneHour >= 0) {
        timezoneHour = "+" + String(timezoneHour);
    }
    timezoneMinute = Math.abs(timezoneMinute);
    var timezone = String(timezoneHour) + ":" + String(timezoneMinute).padStart(2, '0');
    console.log(timezone);
    timezoneSelect.locatePosition(0, timezoneArray.indexOf(timezone));
    document.getElementById("timezoneText").textContent = timezone;

    updateAlarmStatus(alarmData[0]["alarm"]["active"], alarmData[0]["snooze"]["active"], alarmData[0]["snooze"]["remaining"], alarmData[0]["snooze"]["enabled"]);
}
    </script>
</body>
</html>